
// this source generated by GenAI pythonProject
import React from "react";

import styles from "../../styles/createcom.module.css";
import Audit_helper from "../../helper/pfmMgmt/pfCSDet";
import moment from "moment";

import {
  VerticalTimeline,
  VerticalTimelineElement,
} from "react-vertical-timeline-component";
import "react-vertical-timeline-component/style.min.css";

export default class pfCSDetAudit extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      is_loading: false,
      l_display_summary: " ",
      username: null,
      tnnt_id: null,
      auditData: [],
    };
  }

  componentDidMount() {
    const username = global.config.username;
    if (username != null && username !== undefined) {
      this.setState({
        username: username,
        tnnt_id: global.config.tnnt_id,
      });
    }
    this.getAuditData();
  }

  getAuditData = () => {
    const { data } = this.props;
    const filter = { ref_id: data };

    Audit_helper.getAuditData(filter)
      .then((result) => {
        console.log("result: ", result);
        this.setState({ auditData: result });
      })
      .catch((error) => {
        console.log("error: ", error);
      });
  };

  render() {
    const { is_loading, auditData } = this.state;
    const { setVisibility } = this.props;
    let l_display_summary = "";
    return (
      <div className={styles.mainWrapper}>
        {is_loading && (
          <div className={"loadingWrapper"}>
            <div className={"innerLoadingWrapper"}>
              <div class="bouncing-loader">
                <div></div>
                <div></div>
                <div></div>
              </div>
            </div>
          </div>
        )}
        <div className={styles.wrapper} onClick={(e) => e.stopPropagation()}>
          <img
            src="/assets/close-red.png"
            className={styles.closeButton}
            onClick={() => setVisibility(false)}
          />
          <div className={styles.contentWrapper}>
            <p className={styles.title}>Timeline</p>
            <VerticalTimeline lineColor="white">
              {auditData.map((data, index) => {
                l_display_summary=""
                            if (data.id_old !== data.id_new){
                 l_display_summary += 'ID' + ' is changed from ' + data.id_old+ ' to: '+ data.id_new + ' '   ;
            }
            if (data.clt_ref_id_old !== data.clt_ref_id_new){
                 l_display_summary += 'Client Reference ID' + ' is changed from ' + data.clt_ref_id_old+ ' to: '+ data.clt_ref_id_new + ' '   ;
            }
            if (data.subject_old !== data.subject_new){
                 l_display_summary += 'Subject' + ' is changed from ' + data.subject_old+ ' to: '+ data.subject_new + ' '   ;
            }
            if (data.descr_old !== data.descr_new){
                 l_display_summary += 'Description' + ' is changed from ' + data.descr_old+ ' to: '+ data.descr_new + ' '   ;
            }
            if (data.raised_date_old !== data.raised_date_new){
                 l_display_summary += 'Raised Date' + ' is changed from ' + data.raised_date_old+ ' to: '+ data.raised_date_new + ' '   ;
            }
            if (data.closed_date_old !== data.closed_date_new){
                 l_display_summary += 'Closed Date' + ' is changed from ' + data.closed_date_old+ ' to: '+ data.closed_date_new + ' '   ;
            }
            if (data.closed_by_old !== data.closed_by_new){
                 l_display_summary += 'Closed By' + ' is changed from ' + data.closed_by_old+ ' to: '+ data.closed_by_new + ' '   ;
            }
            if (data.uc_category_id_old !== data.uc_category_id_new){
                 l_display_summary += 'UC Category ID' + ' is changed from ' + data.uc_category_id_old+ ' to: '+ data.uc_category_id_new + ' '   ;
            }
            if (data.resolution_old !== data.resolution_new){
                 l_display_summary += 'Resolution' + ' is changed from ' + data.resolution_old+ ' to: '+ data.resolution_new + ' '   ;
            }
            if (data.bug_id_old !== data.bug_id_new){
                 l_display_summary += 'Bug ID' + ' is changed from ' + data.bug_id_old+ ' to: '+ data.bug_id_new + ' '   ;
            }
            if (data.cr_id_old !== data.cr_id_new){
                 l_display_summary += 'CR ID' + ' is changed from ' + data.cr_id_old+ ' to: '+ data.cr_id_new + ' '   ;
            }
            if (data.eta_old !== data.eta_new){
                 l_display_summary += 'ETA' + ' is changed from ' + data.eta_old+ ' to: '+ data.eta_new + ' '   ;
            }
            if (data.ticket_status_id_old !== data.ticket_status_id_new){
                 l_display_summary += 'Ticket Status' + ' is changed from ' + data.ticket_status_id_old+ ' to: '+ data.ticket_status_id_new + ' '   ;
            }
            if (data.lc_status_id_old !== data.lc_status_id_new){
                 l_display_summary += 'Record Status ' + ' is changed from ' + data.lc_status_id_old+ ' to: '+ data.lc_status_id_new + ' '   ;
            }
            if (data.is_active_old !== data.is_active_new){
                 l_display_summary += 'Is Active' + ' is changed from ' + data.is_active_old+ ' to: '+ data.is_active_new + ' '   ;
            }
            if (data.created_at_old !== data.created_at_new){
                 l_display_summary += 'Created At' + ' is changed from ' + data.created_at_old+ ' to: '+ data.created_at_new + ' '   ;
            }
            if (data.created_by_old !== data.created_by_new){
                 l_display_summary += 'Created By' + ' is changed from ' + data.created_by_old+ ' to: '+ data.created_by_new + ' '   ;
            }
            if (data.tnnt_id_old !== data.tnnt_id_new){
                 l_display_summary += 'Tnnt ID' + ' is changed from ' + data.tnnt_id_old+ ' to: '+ data.tnnt_id_new + ' '   ;
            }

                return (
                  <VerticalTimelineElement
                    className="vertical-timeline-element--work"
                    contentStyle={{
                      background: "rgb(33, 150, 243)",
                      color: "#fff",
                    }}
                    contentArrowStyle={{
                      borderRight: "7px solid  rgb(33, 150, 243)",
                    }}
                    date={moment(data.created_at_new).format("LLL")}
                    dateClassName={styles.timelineDate}
                    icon={index + 1}
                    iconClassName={styles.timelineIcon}
                  >
                    <h5>Created By: {data.created_by_new}</h5>
                    <p>Summary: {l_display_summary}</p>
                  </VerticalTimelineElement>
                );
              })}
            </VerticalTimeline>
          </div>
        </div>
      </div>
    );
  }
}
